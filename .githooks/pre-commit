#!/bin/sh
# Pre-commit hook to run all CI checks before committing
# This ensures commits always pass CI

echo "Running ruff format (auto-fix)..."
ruff format . || exit 1

echo "Running ruff lint check..."
ruff check . || exit 1

echo "Running mypy type check..."
python -m mypy src tests || exit 1

echo "Running tests with coverage..."
# Use a fixed temp away from OneDrive (Git Bash path style)
export TMPDIR="/c/Temp/pytest"
mkdir -p "$TMPDIR"
export TMP="$TMPDIR"
export TEMP="$TMPDIR"
export COVERAGE_FILE="$TMPDIR/.coverage"
export PYTHONPATH="$PWD/src${PYTHONPATH:+:$PYTHONPATH}"
python -m pytest --basetemp "$TMPDIR" --cov --cov-report=term --cov-config=pyproject.toml || exit 1

echo ""
echo "All CI checks passed! Committing..."
exit 0


